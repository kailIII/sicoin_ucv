(dp1
S'output'
p2
S'<class \'gluon.contrib.pymysql.err.ProgrammingError\'> (1064, u"You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near \' documento.tipo_de_documento\' at line 1")'
p3
sS'layer'
p4
S'/home/perdomor/web2py/applications/sicoin/controllers/correspondencia.py'
p5
sS'code'
p6
S'# coding: utf8\nT.force(\'es\')\nfrom plugin_solidform import SOLIDFORM\n\n@auth.requires(auth.has_membership(\'recepcionista\') or auth.has_membership(\'master\') or auth.has_membership(\'supervisor\') or auth.has_membership(\'analista\'))\ndef listar_correspondencias():\n    session.pag_editar = URL("editar_correspondencia")\n    session.pag_previa = URL(\'listar_correspondencias\')\n    db.correspondencia.fecha_registro.readable = True\n    links = None \n    fields = [db.correspondencia.nro_de_documento, db.correspondencia.fecha_registro, db.correspondencia.tipo_de_documento,\n              db.correspondencia.estatus,db.correspondencia.remitente,db.correspondencia.destinatario,db.correspondencia.asunto,]\n    orderby = [~db.correspondencia.fecha_registro,] \n    if auth.has_membership(\'recepcionista\'):\n        deletable = False\n        editable=True\n        details = True\n        create=True\n    if auth.has_membership(\'analista\'):\n        deletable = False\n        editable=True\n        details = True\n        create=False\n    if auth.has_membership(\'supervisor\'):\n        deletable = False\n        editable=True\n        details = True\n        create=False\n    query = ((db.correspondencia.registrado_por==auth.user.id) | (db.correspondencia.asignado_a==auth.user.id))\n    if auth.has_membership(\'master\'):\n        deletable = False\n        editable=False\n        details = True\n        create=False\n        query = ((db.correspondencia.registrado_por==auth.user.id) | (db.correspondencia.asignado_a==auth.user.id))\n    links = [lambda row: A(TAG[\'\'](SPAN(_class="icon icon-list"),SPAN(\'Hist\xc3\xb3rico\', _class="buttontext button", _title="Hist\xc3\xb3rico")), _class="w2p_trap button btn popup", _href=URL(\'ver_historico\', args=[row.id]))\n            ]\n    grid = SQLFORM.grid(query, fields = fields, user_signature=False, selectable= lambda ids: reporte_entregas(ids),deletable=deletable, editable=editable, details = details,create=create, csv=False, orderby = orderby, links = links)\n    return dict(grid = grid)\n\n@auth.requires(auth.has_membership(\'recepcionista\') or auth.has_membership(\'supervisor\') or auth.has_membership(\'master\'))\ndef listar_correspondencias_departamento():\n    session.pag_editar = URL("editar_correspondencia_departamento")\n    session.pag_previa = URL(\'listar_correspondencias_departamento\') \n    fields = [db.correspondencia.nro_de_documento,db.correspondencia.fecha_registro,db.correspondencia.estatus,db.correspondencia.remitente,db.correspondencia.destinatario,db.correspondencia.asunto,]\n    orderby = [\'correspondencia.fecha_registro\',] \n    deletable = False\n    editable=True\n    details = True\n    create=False\n    db.correspondencia.nro_de_documento.writable = False\n    db.correspondencia.fecha_registro.writable = False\n    db.correspondencia.tipo_de_documento.writable = False\n    db.correspondencia.remitente.writable = False\n    db.correspondencia.departamento_origen.writable = False\n    db.correspondencia.destinatario.writable = False\n    db.correspondencia.departamento_destino.writable = False\n    db.correspondencia.asunto.writable = False\n    db.correspondencia.registrado_por.writable = False\n    links = [lambda row: A(TAG[\'\'](SPAN(_class="icon icon-list"),SPAN(\'Hist\xc3\xb3rico\', _class="buttontext button", _title="Hist\xc3\xb3rico")), _class="w2p_trap button btn popup", _href=URL(\'ver_historico\', args=[row.id]))]\n    query = (db.correspondencia.departamento_destino==auth.user.departamento)|(db.correspondencia.departamento_origen==auth.user.departamento)\n    grid = SQLFORM.grid(query, fields = fields, user_signature=False, deletable=deletable, editable=editable, \n                        details = details,create=create, csv=False, orderby = orderby, links = links)\n    return dict(grid = grid)      \n      \n@auth.requires(auth.has_membership(\'master\'))\ndef listar_correspondencias_master(): \n    session.pag_previa = URL(\'listar_correspondencias_master\') \n    fields = [db.correspondencia.nro_de_documento,db.correspondencia.fecha_registro,db.correspondencia.estatus,db.correspondencia.remitente,db.correspondencia.destinatario,db.correspondencia.asunto,]\n    orderby = [~db.correspondencia.fecha_registro, db.correspondencia.departamento_origen, db.correspondencia.departamento_origen] \n    deletable = False\n    editable=False\n    details = True\n    create=False\n    links = [lambda row: A(TAG[\'\'](SPAN(_class="icon icon-list"),SPAN(\'Hist\xc3\xb3rico\', _class="buttontext button", _title="Hist\xc3\xb3rico")), _class="w2p_trap button btn popup", _href=URL(\'ver_historico\', args=[row.id]))]\n    query =db.correspondencia \n    grid = SQLFORM.grid(query, fields = fields, user_signature=False, deletable=deletable, editable=editable, \n                        details = details,create=create, csv=False, orderby = orderby, links = links)\n    return dict(grid = grid)\n\n@auth.requires(auth.has_membership(\'recepcionista\') or auth.has_membership(\'master\') or auth.has_membership(\'supervisor\'))\ndef agregar_correspondencia():\n    session.pag_previa = URL(\'agregar_correspondencia\') \n    request_fields = request.vars.fields or \'default\'\n    asignados = usuariosDepartamento()\n\n################################ The core ######################################\n    # Specify structured fields for the multi-line form layout.\n    # A "None" indicates an empty line over which the precedent line spans\n    if request_fields == \'default\':\n        fields = [\n                  [\'nro_de_documento\', \'fecha_correspondencia\'],\n                  [\'tipo_de_documento\', \'estatus\'],\n                  \'asunto\',\n                  [\'departamento_origen\', \'departamento_destino\'],\n                  [None, None],\n                  [\'remitente\', \'destinatario\'],\n                  [None, \'observaciones\'],\n                  \'asignado_a\'\n                  ]\n    \n    form = SOLIDFORM(db.correspondencia, fields=fields, tabla = auth.archive)\n    if form.process(onsuccess=auth.archive).accepted:\n        session.flash = \'registro procesado con \xc3\xa9xito\'\n        redirect(URL(\'/listar_correspondencias\'))\n    style = STYLE("""input[type="text"], textarea {width:100%; max-height: 50px;}\n                     .w2p_fw {padding-right: 10px; max-width:100%;}\n                     .w2p_fl {background: #eee;}\n                     .string {max-width: 300px;}\n                     .date {max-width: 80px;}""")\n    return dict(asignados = asignados,\n                form=DIV(style, form),\n                #form__factory=form_factory, form__readonly=form_readonly, form__edit=form_edit,\n                form_args=DIV(A(\'fields=default\', _href=URL(vars={\'fields\': \'default\'})), \' \',\n                               ))\n\n@auth.requires(auth.has_membership(\'recepcionista\') or auth.has_membership(\'master\') or auth.has_membership(\'supervisor\') or auth.has_membership(\'analista\'))\ndef ver_correspondencia():\n    id = request.args(1)\n    tabla = request.args(0)\n    fields = [\n                  [\'nro_de_documento\', \'fecha_correspondencia\'],\n                  [\'tipo_de_documento\', \'estatus\'],\n                  \'asunto\',\n                  [\'departamento_origen\', \'departamento_destino\'],\n                  [None, None],\n                  [\'remitente\', \'destinatario\'],\n                  [None, \'observaciones\'],\n                  [\'asignado_a\', \'registrado_por\'],\n                  [\'modificado_el\', \'modificado_por\'],\n                  ]\n\n    if (tabla == "activo"):\n        db.correspondencia.modificado_el.readable = True\n        db.correspondencia.modificado_por.readable = True\n        correspondencia = db(db.correspondencia.id==id).select().first()\n        form = SOLIDFORM(db.correspondencia, correspondencia, fields=fields, showid=False, readonly=True)\n    elif (tabla == "archivo"):\n        db.correspondencia_archive.modificado_el.readable = True\n        db.correspondencia_archive.modificado_por.readable = True\n        correspondencia = db(db.correspondencia_archive.id==id).select().first()\n        form = SOLIDFORM(db.correspondencia_archive, correspondencia, fields=fields, showid=False, readonly=True)\n    if form.accepts(request.vars, session):\n        session.flash = \'registro procesado con \xc3\xa9xito\'\n        redirect(URL(\'/listar_correspondencias\'))\n     \n    style = STYLE("""input[type="text"], textarea {width:100%; max-height: 50px;}\n                     .w2p_fw {padding-right: 10px; max-width:100%;}\n                     .w2p_fl {background: #eee;}\n                     .string {max-width: 300px;}\n                     .date {max-width: 80px;}""")\n    return dict(id = id, form=DIV(style, form),\n                #form__factory=form_factory, form__readonly=form_readonly, form__edit=form_edit,\n                form_args=DIV(A(\'fields=default\', _href=URL(vars={\'fields\': \'default\'})), \' \',\n\n                               ))\n                            \n@auth.requires(auth.has_membership(\'recepcionista\') or auth.has_membership(\'master\') or auth.has_membership(\'supervisor\') or auth.has_membership(\'analista\'))\ndef editar_correspondencia():\n    session.pag_previa = URL(\'editar_correspondencia\') \n    id = request.args(0)\n    asignados = usuariosDepartamento()\n    fields = [\n                  [\'nro_de_documento\', \'fecha_correspondencia\'],\n                  [\'tipo_de_documento\', \'estatus\'],\n                  \'asunto\',\n                  [\'departamento_origen\', \'departamento_destino\'],\n                  [None, None],\n                  [\'remitente\', \'destinatario\'],\n                  [None, \'observaciones\'],\n                  [\'asignado_a\'],\n                  \n                  ]\n    if auth.has_membership(\'analista\'):\n        db.correspondencia.nro_de_documento.readable = True\n        db.correspondencia.nro_de_documento.writable = False\n        db.correspondencia.fecha_correspondencia.readable = True\n        db.correspondencia.fecha_correspondencia.writable = False\n        db.correspondencia.tipo_de_documento.readable = True\n        db.correspondencia.tipo_de_documento.writable = False\n        db.correspondencia.asunto.readable = True\n        db.correspondencia.asunto.writable = False\n        db.correspondencia.departamento_origen.readable = True\n        db.correspondencia.departamento_origen.writable = False\n        db.correspondencia.departamento_destino.readable = True\n        db.correspondencia.departamento_destino.writable = False\n        db.correspondencia.remitente.readable = True\n        db.correspondencia.remitente.writable = False\n        db.correspondencia.destinatario.readable = True\n        db.correspondencia.destinatario.writable = False        \n        db.correspondencia.asignado_a.readable = True\n        db.correspondencia.asignado_a.writable = False\n    if auth.has_membership(\'supervisor\'):\n        db.correspondencia.nro_de_documento.readable = True\n        db.correspondencia.nro_de_documento.writable = False\n        db.correspondencia.fecha_correspondencia.readable = True\n        db.correspondencia.fecha_correspondencia.writable = False\n        db.correspondencia.tipo_de_documento.readable = True\n        db.correspondencia.tipo_de_documento.writable = False\n        db.correspondencia.asunto.readable = True\n        db.correspondencia.asunto.writable = False\n        db.correspondencia.departamento_origen.readable = True\n        db.correspondencia.departamento_origen.writable = False\n        db.correspondencia.departamento_destino.readable = True\n        db.correspondencia.departamento_destino.writable = False\n        db.correspondencia.remitente.readable = True\n        db.correspondencia.remitente.writable = False\n        db.correspondencia.destinatario.readable = True\n        db.correspondencia.destinatario.writable = False        \n        db.correspondencia.asignado_a.readable = True\n        db.correspondencia.asignado_a.writable = False\n    #db.correspondencia.modificado_por.writable = True\n    #db.correspondencia.modificado_el.writable = True\n    correspondencia = db(db.correspondencia.id==id).select().first()\n    form = SOLIDFORM(db.correspondencia, correspondencia, fields=fields, showid=False, readonly=False)\n    if form.process(onsuccess=auth.archive).accepted:\n        session.flash = \'registro modificado con \xc3\xa9xito\'\n        redirect(URL(\'/listar_correspondencias\'))\n     \n    style = STYLE("""input[type="text"], textarea {width:100%; max-height: 50px;}\n                     .w2p_fw {padding-right: 10px; max-width:100%;}\n                     .w2p_fl {background: #eee;}\n                     .string {max-width: 300px;}\n                     .date {max-width: 80px;}""")\n    return dict(asignados = asignados,\n                 form=DIV(style, form),\n                 #form__factory=form_factory, form__readonly=form_readonly, form__edit=form_edit,\n                 form_args=DIV(A(\'fields=default\', _href=URL(vars={\'fields\': \'default\'})), \' \',\n\n                               ))\n\n@auth.requires(auth.has_membership(\'recepcionista\') or auth.has_membership(\'supervisor\') or auth.has_membership(\'master\'))\ndef ver_correspondencia_departamento():\n    id = request.args(0)\n    fields = [\n                  [\'nro_de_documento\', \'fecha_correspondencia\'],\n                  [\'tipo_de_documento\', \'estatus\'],\n                  \'asunto\',\n                  [\'departamento_origen\', \'departamento_destino\'],\n                  [None, None],\n                  [\'remitente\', \'destinatario\'],\n                  [None, \'observaciones\'],\n                  [\'asignado_a\', \'registrado_por\'],\n                  [\'modificado_el\', \'modificado_por\'],\n                  ]\n    db.correspondencia.nro_de_documento.writable = False\n    db.correspondencia.fecha_registro.writable = False\n    db.correspondencia.tipo_de_documento.writable = False\n    db.correspondencia.remitente.writable = False\n    db.correspondencia.departamento_origen.writable = False\n    db.correspondencia.destinatario.writable = False\n    db.correspondencia.departamento_destino.writable = False\n    db.correspondencia.asunto.writable = False\n    db.correspondencia.registrado_por.writable = False\n    db.correspondencia.modificado_el.readable = True\n    db.correspondencia.modificado_por.readable = True\n    correspondencia = db(db.correspondencia.id==id).select().first()\n    form = SOLIDFORM(db.correspondencia, correspondencia, fields=fields, showid=False, readonly=True)\n\n    if form.accepts(request.vars, session):\n        session.flash = \'registro procesado con \xc3\xa9xito\'\n        redirect(URL(\'/listar_correspondencias\'))\n     \n    style = STYLE("""input[type="text"], textarea {width:100%; max-height: 50px;}\n                     .w2p_fw {padding-right: 10px; max-width:100%;}\n                     .w2p_fl {background: #eee;}\n                     .string {max-width: 300px;}\n                     .date {max-width: 80px;}""")\n    return dict(id = id, form=DIV(style, form),\n                #form__factory=form_factory, form__readonly=form_readonly, form__edit=form_edit,\n                form_args=DIV(A(\'fields=default\', _href=URL(vars={\'fields\': \'default\'})), \' \',\n                               ))\n                              \n@auth.requires(auth.has_membership(\'recepcionista\') or auth.has_membership(\'supervisor\') or auth.has_membership(\'master\'))\ndef editar_correspondencia_departamento():\n    session.pag_previa = URL(\'editar_correspondencias_departamento\') \n    id = request.args(0)\n    asignados = usuariosDepartamento()\n    fields = [\n                  [\'nro_de_documento\', \'fecha_correspondencia\'],\n                  [\'tipo_de_documento\', \'estatus\'],\n                  \'asunto\',\n                  [\'departamento_origen\', \'departamento_destino\'],\n                  [None, None],\n                  [\'remitente\', \'destinatario\'],\n                  [None, \'observaciones\'],\n                  \'asignado_a\'\n                  ]\n    db.correspondencia.nro_de_documento.readable = True\n    db.correspondencia.nro_de_documento.writable = False\n    db.correspondencia.fecha_correspondencia.readable = True\n    db.correspondencia.fecha_correspondencia.writable = False\n    db.correspondencia.tipo_de_documento.readable = True\n    db.correspondencia.tipo_de_documento.writable = False\n    db.correspondencia.asunto.readable = True\n    db.correspondencia.asunto.writable = False\n    db.correspondencia.departamento_origen.readable = True\n    db.correspondencia.departamento_origen.writable = False\n    db.correspondencia.departamento_destino.readable = True\n    db.correspondencia.departamento_destino.writable = False\n    db.correspondencia.remitente.readable = True\n    db.correspondencia.remitente.writable = False\n    db.correspondencia.destinatario.readable = True\n    db.correspondencia.destinatario.writable = False        \n    db.correspondencia.asignado_a.readable = True\n    db.correspondencia.asignado_a.writable = True\n    \n    correspondencia = db(db.correspondencia.id==id).select().first()\n    form = SOLIDFORM(db.correspondencia, correspondencia, fields=fields, showid=False, readonly=False)\n    \n    if form.process(onsuccess=auth.archive).accepted:\n        session.flash = \'registro procesado con \xc3\xa9xito\'\n        redirect(URL(\'/listar_correspondencias_departamento\'))     \n\n    style = STYLE("""input[type="text"], textarea {width:100%; max-height: 50px;}\n                     .w2p_fw {padding-right: 10px; max-width:100%;}\n                     .w2p_fl {background: #eee;}\n                     .string {max-width: 300px;}\n                     .date {max-width: 80px;}""")\n    return dict(asignados = asignados,\n                form=DIV(style, form),\n                #form__factory=form_factory, form__readonly=form_readonly, form__edit=form_edit,\n                form_args=DIV(A(\'fields=default\', _href=URL(vars={\'fields\': \'default\'})), \' \',\n                               ))\n                               \ndef ver_historico():\n    id_registro = request.args(0)\n    #<a href="/sicoin/correspondencia/ver_correspondencia/4" class="w2p_trap button btn"><span class="icon magnifier icon-zoom-in"></span><span title="View" class="buttontext button">Vista</span></a>\n    db.correspondencia.id.represent= lambda value, row: CENTER(A(TAG[\'\'](SPAN(_class="icon magnifier icon-zoom-in"),SPAN(\'\', _class="buttontext button")),_class="w2p_trap button btn", _href = URL(\'ver_correspondencia/activo\', args = str(value))))                                                                   \n                                                                          \n    rows_actual = db(db.correspondencia.id==id_registro).select(db.correspondencia.modificado_el,\n                                                                             db.correspondencia.modificado_por,\n                                                                             db.correspondencia.nro_de_documento,\n                                                                             db.correspondencia.tipo_de_documento,\n                                                                             db.estatus.tipo_estatus, \n                                                                             db.correspondencia.remitente,\n                                                                             db.correspondencia.departamento_origen,\n                                                                             db.correspondencia.destinatario,\n                                                                             db.correspondencia.departamento_destino,\n                                                                             db.correspondencia.asunto,\n                                                                             db.correspondencia.observaciones,\n                                                                             db.correspondencia.id,\n                                                                     left=[db.estatus.on(db.estatus.id==db.correspondencia.estatus)])\n    db.correspondencia_archive.id.represent= lambda value, row: CENTER(A(TAG[\'\'](SPAN(_class="icon magnifier icon-zoom-in"),SPAN(\'\', _class="buttontext button")),_class="w2p_trap button btn", _href = URL(\'ver_correspondencia/archivo\', args = str(value))))\n    rows = db(db.correspondencia_archive.current_record==id_registro).select(db.correspondencia_archive.modificado_el,\n                                                                             db.correspondencia_archive.modificado_por,\n                                                                             db.correspondencia_archive.nro_de_documento,\n                                                                             db.correspondencia_archive.tipo_de_documento,\n                                                                             db.estatus.tipo_estatus, \n                                                                             db.correspondencia_archive.remitente,\n                                                                             db.correspondencia_archive.departamento_origen,\n                                                                             db.correspondencia_archive.destinatario,\n                                                                             db.correspondencia_archive.departamento_destino,\n                                                                             db.correspondencia_archive.asunto,\n                                                                             db.correspondencia_archive.observaciones,\n                                                                             db.correspondencia_archive.id,\n                                                                     left=[db.estatus.on(db.estatus.id==db.correspondencia_archive.estatus)])\n\n    headers = {\'correspondencia_archive.modificado_el\':{\'label\':\'Modificado el\',\n                       \'class\':\'\', #class name of the header\n                       \'width\':\'\', #width in pixels or %\n                       \'truncate\': 16, #truncate the content to...\n                       \'selected\': False #agregate class selected to this column\n                       },\n               \'correspondencia_archive.modificado_por\':{\'label\':\'Modificado por\',\n                            \'class\':\'\', #class name of the header\n                            \'width\':\'\', #width in pixels or %\n                            \'truncate\': 16, #truncate the content to...\n                            \'selected\': False #agregate class selected to this column\n                            },\n               \'correspondencia_archive.nro_de_documento\':{\'label\':\'Nro Documento\',\n                            \'class\':\'\', #class name of the header\n                            \'width\':\'\', #width in pixels or %\n                            \'truncate\': 16, #truncate the content to...\n                            \'selected\': False #agregate class selected to this column\n                            },\n               \'correspondencia_archive.tipo_de_documento\':{\'label\':\'Tipo Documento\',\n                            \'class\':\'\', #class name of the header\n                            \'width\':\'\', #width in pixels or %\n                            \'truncate\': 16, #truncate the content to...\n                            \'selected\': False #agregate class selected to this column\n                            },\n               \'estatus.tipo_estatus\':{\'label\':\'Estatus\',\n                            \'class\':\'\', #class name of the header\n                            \'width\':\'\', #width in pixels or %\n                            \'truncate\': 16, #truncate the content to...\n                            \'selected\': False #agregate class selected to this column\n                            },\n               \'correspondencia_archive.remitente\':{\'label\':\'Remitente\',\n                            \'class\':\'\', #class name of the header\n                            \'width\':\'\', #width in pixels or %\n                            \'truncate\': 50, #truncate the content to...\n                            \'selected\': False #agregate class selected to this column\n                            },\n               \'correspondencia_archive.departamento_origen\':{\'label\':\'Dpto. Origen\',\n                            \'class\':\'\', #class name of the header\n                            \'width\':\'\', #width in pixels or %\n                            \'truncate\': 16, #truncate the content to...\n                            \'selected\': False #agregate class selected to this column\n                            },\n               \'correspondencia_archive.destinatario\':{\'label\':\'Destinatario\',\n                            \'class\':\'\', #class name of the header\n                            \'width\':\'\', #width in pixels or %\n                            \'truncate\': 60, #truncate the content to...\n                            \'selected\': False #agregate class selected to this column\n                            },\n               \'correspondencia_archive.departamento_destino\':{\'label\':\'Depto. Destino\',\n                            \'class\':\'\', #class name of the header\n                            \'width\':\'\', #width in pixels or %\n                            \'truncate\': 16, #truncate the content to...\n                            \'selected\': False #agregate class selected to this column\n                            },\n                \'correspondencia_archive.asunto\':{\'label\':\'Asunto\',\n                            \'class\':\'\', #class name of the header\n                            \'width\':\'15%\', #width in pixels or %\n                            \'truncate\': 50, #truncate the content to...\n                            \'selected\': False #agregate class selected to this column\n                            },\n                \'correspondencia_archive.observaciones\':{\'label\':\'Observaciones\',\n                            \'class\':\'\', #class name of the header\n                            \'width\':\'20%\', #width in pixels or %\n                            \'truncate\': 50, #truncate the content to...\n                            \'selected\': False #agregate class selected to this column\n                            },\n                \'correspondencia_archive.id\':{\'label\':\'Acci\xc3\xb3n\',\n                            \'class\':\'\', #class name of the header\n                            \'width\':\'10%\', #width in pixels or %\n                            \'truncate\': 50, #truncate the content to...\n                            \'selected\': False, #agregate class selected to this column\n                            \'align\': \'center\'\n                            },\n           }\n    tabla = SQLTABLE(rows, headers = headers)\n    tabla_actual = SQLTABLE(rows_actual, truncate = 100)\n    return dict(table=tabla, tabla_actual =tabla_actual,id = id)\n    \n@auth.requires(auth.has_membership(\'recepcionista\') or auth.has_membership(\'master\') or auth.has_membership(\'supervisor\') or auth.has_membership(\'analista\'))\ndef listar_movimientos():\n    session.pag_previa = URL(\'listar_movimientos\') \n    links = None \n    fields = [db.correspondencia.nro_de_documento, db.correspondencia.tipo_de_documento,db.correspondencia.fecha_registro,\n              db.correspondencia.estatus,db.correspondencia.remitente,db.correspondencia.destinatario,db.correspondencia.asunto,]\n    orderby = [\'correspondencia.fecha_registro\',] \n    deletable = False\n    editable=True\n    details = True\n    create=True\n    documento = db(db.documento.tipo_de_documento=="movimiento").select(db.documento.id).first()\n    id_documento_movimiento = documento[\'id\']\n    query = (((db.correspondencia.registrado_por==auth.user.id) | (db.correspondencia.asignado_a==auth.user.id)) & (db.correspondencia.tipo_de_documento==id_documento_movimiento))\n    links = [lambda row: A(TAG[\'\'](SPAN(_class="icon icon-list"),SPAN(\'Hist\xc3\xb3rico\', _class="buttontext button", _title="Hist\xc3\xb3rico")), _class="w2p_trap button btn popup", _href=URL(\'ver_historico\', args=[row.id]))\n            ]\n    grid = SQLFORM.grid(query, fields = fields, selectable= lambda ids: reporte_entrega_movimiento(ids), user_signature=False, deletable=deletable, editable=editable, details = details,create=create, csv=False, orderby = orderby, links = links)\n    return dict(grid = grid)\n    \ndef reporte_entrega_movimiento(ids):\n    if not ids:\n        session.flash=\'No has seleccionado ninguna correspondencia\'\n    else: \n        #import gluon.contenttype\n        al_reporte=db(db.correspondencia.id.belongs(ids)).select(db.correspondencia.nro_de_documento, db.correspondencia.departamento_destino)\n        headers = {\'correspondencia.nro_de_documento\':{\'label\':\'Nro. Documento\',\n                       \'class\':\'\', #class name of the header\n                       \'width\':\'\', #width in pixels or %\n                       \'truncate\': 16, #truncate the content to...\n                       \'selected\': False #agregate class selected to this column\n                       },\n               \'correspondencia.departamento_destino\':{\'label\':\'Departamento Destino\',\n                            \'class\':\'\', #class name of the header\n                            \'width\':\'\', #width in pixels or %\n                            \'truncate\': 16, #truncate the content to...\n                            \'selected\': False #agregate class selected to this column\n                            },           \n           }\n        tabla_actual = SQLTABLE(al_reporte, truncate = 100, headers = headers)\n        session.reporte_movimiento = tabla_actual\n        session.flash="Reporte Generado"\n        #response.headers[\'Content-Type\']=gluon.contenttype.contenttype(\'.js\')\n        #return \'alert("alerta en javascript");\'\n        #response.render();\n        #session.flash=al_reporte[1]        \n\treturn ()\n\t\ndef reporte_entregas(ids):\n    if not ids:\n        session.flash=\'No has seleccionado ninguna correspondencia\'\n    else: \n        #import gluon.contenttype\n        al_reporte=db(db.correspondencia.id.belongs(ids)).select(db.correspondencia.nro_de_documento, db.correspondencia.departamento_destino)\n        headers = {\'correspondencia.nro_de_documento\':{\'label\':\'Nro. Documento\',\n                       \'class\':\'\', #class name of the header\n                       \'width\':\'\', #width in pixels or %\n                       \'truncate\': 16, #truncate the content to...\n                       \'selected\': False #agregate class selected to this column\n                       },\n               \'correspondencia.departamento_destino\':{\'label\':\'Departamento Destino\',\n                            \'class\':\'\', #class name of the header\n                            \'width\':\'\', #width in pixels or %\n                            \'truncate\': 16, #truncate the content to...\n                            \'selected\': False #agregate class selected to this column\n                            },           \n           }\n        tabla_actual = SQLTABLE(al_reporte, truncate = 100, headers = headers)\n        session.reporte = tabla_actual\n        #response.headers[\'Content-Type\']=gluon.contenttype.contenttype(\'.js\')\n        #return \'alert("alerta en javascript");\'\n        #response.render();\n        #session.flash=al_reporte[1]        \n\treturn ()\n\ndef devolver_mes(mes):\n    if mes == 1:\n        mes= "enero"\n    elif mes == 2:\n        mes= "febrero"\n    elif mes == 3:\n        mes= "marzo"\n    elif mes == 4:\n        mes= "abril"\n    elif mes == 5:\n        mes= "mayo"\n    elif mes == 6:\n        mes= "junio"\n    elif mes == 7:\n        mes= "julio"\n    elif mes == 8:\n        mes= "agosto"\n    elif mes == 9:\n        mes= "septiembre"    \n    elif mes == 10:\n        mes= "octubre"\n    elif mes == 11:\n        mes= "noviembre"\n    else:\n        mes = "diciembre"\n    return mes\n    \ndef usuariosDepartamento():\n    options = [OPTION(t.first_name + " " + t.last_name,_value=t.id) for t in db(db.auth_user.departamento==auth.user.departamento).select(db.auth_user.id, db.auth_user.first_name, db.auth_user.last_name)]\n    options.insert(0, OPTION(_value=""))\n    usuarios = SELECT(*options, _name="asignado_a", _id="correspondencia_asignados", _class="generic-widget")\n    #usuarios = db(db.auth_user.departamento==auth.user.departamento).select(db.auth_user.id, db.auth_user.first_name, db.auth_user.last_name)\n    return usuarios\n    \ndef correspondenciasDependencia():\n    documentos = db(db.documento.ALL).select(db.documento.tipo_de_documento)\n    form = SQLFORM.factory(db.documento, db.dependencia)\n    if form.process().accepted:\n        session.flash=\'registro procesado\'\n    else:\n        session.flash=\'registro no procesado\'\n    return dict(form = form)\n\nresponse._vars=response._caller(correspondenciasDependencia)\n'
p7
sS'snapshot'
p8
(dp9
sS'traceback'
p10
S'Traceback (most recent call last):\n  File "/home/perdomor/web2py/gluon/restricted.py", line 209, in restricted\n    exec ccode in environment\n  File "/home/perdomor/web2py/applications/sicoin/controllers/correspondencia.py", line 554, in <module>\n  File "/home/perdomor/web2py/gluon/globals.py", line 186, in <lambda>\n    self._caller = lambda f: f()\n  File "/home/perdomor/web2py/applications/sicoin/controllers/correspondencia.py", line 546, in correspondenciasDependencia\n    documentos = db(db.documento.ALL).select(db.documento.tipo_de_documento)\n  File "/home/perdomor/web2py/gluon/dal.py", line 8766, in select\n    return adapter.select(self.query,fields,attributes)\n  File "/home/perdomor/web2py/gluon/dal.py", line 1594, in select\n    return self._select_aux(sql,fields,attributes)\n  File "/home/perdomor/web2py/gluon/dal.py", line 1559, in _select_aux\n    self.execute(sql)\n  File "/home/perdomor/web2py/gluon/dal.py", line 1671, in execute\n    return self.log_execute(*a, **b)\n  File "/home/perdomor/web2py/gluon/dal.py", line 1665, in log_execute\n    ret = self.cursor.execute(*a, **b)\n  File "/home/perdomor/web2py/gluon/contrib/pymysql/cursors.py", line 117, in execute\n    self.errorhandler(self, exc, value)\n  File "/home/perdomor/web2py/gluon/contrib/pymysql/connections.py", line 202, in defaulterrorhandler\n    raise errorclass, errorvalue\nProgrammingError: (1064, u"You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near \' documento.tipo_de_documento\' at line 1")\n'
p11
s.